import { NextResponse } from 'next/server';

const HTML = '<!DOCTYPE html>\n<html lang="ru">\n<head>\n  <meta charset="UTF-8"/>\n  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>\n  <meta name="apple-mobile-web-app-capable" content="yes"/>\n  <meta name="theme-color" content="#0A0C0F"/>\n  <title>GodLocal Voice</title>\n  <style>\n    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}\n    :root{--bg:#0A0C0F;--s:#111316;--b:#1e2127;--g:#00FF9D;--p:#6C5CE7;--t:#E0E0E0;--m:rgba(224,224,224,.45);--d:rgba(224,224,224,.15)}\n    html,body{height:100%;background:var(--bg);color:var(--t);\n      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;\n      overflow:hidden;-webkit-tap-highlight-color:transparent}\n    #app{display:flex;flex-direction:column;height:100%}\n    header{display:flex;align-items:center;justify-content:space-between;\n      padding:12px 16px;border-bottom:1px solid var(--b);\n      background:rgba(10,12,15,.92);backdrop-filter:blur(12px);flex-shrink:0;z-index:10}\n    .logo{display:flex;align-items:center;gap:8px;text-decoration:none;color:var(--t)}\n    .li{width:26px;height:26px;border-radius:6px;background:rgba(0,255,157,.1);\n      border:1px solid rgba(0,255,157,.3);display:flex;align-items:center;justify-content:center;\n      font-family:monospace;font-weight:700;font-size:12px;color:var(--g)}\n    .lt{font-weight:700;font-size:15px}.lt span{color:var(--g)}\n    .hr{display:flex;align-items:center;gap:10px}\n    #dot{width:7px;height:7px;border-radius:50%;background:#444;transition:all .3s}\n    #dot.on{background:var(--g);box-shadow:0 0 6px rgba(0,255,157,.7)}\n    #dot.err{background:#FF6B6B}\n    #dot.warm{background:#F0A500;animation:blink .8s ease-in-out infinite}\n    @keyframes blink{0%,100%{opacity:.4}50%{opacity:1}}\n    #sb-btn{background:none;border:none;cursor:pointer;color:var(--m);font-size:17px;padding:4px 6px;line-height:1}\n    #chat{flex:1;overflow-y:auto;padding:12px 14px 4px;display:flex;flex-direction:column;gap:8px}\n    #chat::-webkit-scrollbar{width:2px}\n    #chat::-webkit-scrollbar-thumb{background:rgba(255,255,255,.08)}\n    .msg{display:flex;flex-direction:column;max-width:84%;animation:fu .22s ease}\n    @keyframes fu{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}\n    .msg.u{align-self:flex-end;align-items:flex-end}\n    .msg.a{align-self:flex-start;align-items:flex-start}\n    .bbl{padding:9px 13px;border-radius:15px;font-size:14px;line-height:1.55}\n    .msg.u .bbl{background:rgba(0,255,157,.1);border:1px solid rgba(0,255,157,.2);border-bottom-right-radius:3px}\n    .msg.a .bbl{background:var(--s);border:1px solid var(--b);border-bottom-left-radius:3px}\n    .msg.err .bbl{background:rgba(255,107,107,.08);border:1px solid rgba(255,107,107,.25);color:#FF8A8A}\n    .ts{font-size:10px;color:var(--d);margin-top:2px;padding:0 3px;font-family:monospace}\n    .dots{display:inline-flex;gap:4px}\n    .dots span{width:6px;height:6px;border-radius:50%;background:var(--g);opacity:.3;animation:bk 1.2s infinite}\n    .dots span:nth-child(2){animation-delay:.2s}.dots span:nth-child(3){animation-delay:.4s}\n    @keyframes bk{0%,80%,100%{opacity:.2;transform:scale(.9)}40%{opacity:1;transform:scale(1.1)}}\n    #empty{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\n      gap:6px;text-align:center}\n    #empty .ei{font-size:42px;opacity:.3;margin-bottom:4px}\n    #empty p{font-size:13px;line-height:1.65;max-width:190px;color:var(--m)}\n    #empty small{font-size:11px;font-family:monospace;color:var(--d)}\n    #live{flex-shrink:0;padding:3px 18px;min-height:22px;font-size:12px;font-style:italic;\n      color:var(--m);opacity:0;transition:opacity .2s}\n    #live.on{opacity:1}\n    #bot{flex-shrink:0;padding:10px 14px 22px;border-top:1px solid var(--b);\n      background:linear-gradient(to top,rgba(0,255,157,.03),transparent);\n      display:flex;flex-direction:column;align-items:center;gap:10px}\n    #st{font-size:12px;font-family:monospace;color:var(--m);height:15px;transition:color .2s;text-align:center}\n    #st.ls{color:var(--g)}#st.tk{color:var(--p)}#st.sp{color:#00B4D8}#st.er{color:#FF8A8A}#st.wm{color:#F0A500}\n    #orb{width:66px;height:66px;border-radius:50%;background:var(--s);\n      border:2px solid rgba(0,255,157,.2);display:flex;align-items:center;justify-content:center;\n      cursor:pointer;transition:all .15s;-webkit-user-select:none;user-select:none;\n      touch-action:manipulation;-webkit-tap-highlight-color:rgba(0,255,157,.15);outline:none}\n    #orb:active{transform:scale(.92);background:rgba(0,255,157,.12);border-color:var(--g)}\n    #orb.ls{background:rgba(0,255,157,.1);border-color:var(--g);animation:pulse 1.4s ease-in-out infinite}\n    #orb.tk{background:rgba(108,92,231,.1);border-color:var(--p)}\n    #orb.sp{background:rgba(0,180,216,.1);border-color:#00B4D8}\n    #orb.er{background:rgba(255,107,107,.1);border-color:#FF6B6B}\n    #orb.wm{background:rgba(240,165,0,.08);border-color:#F0A500;animation:pulse2 1.6s ease-in-out infinite}\n    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(0,255,157,.4)}70%{box-shadow:0 0 0 16px rgba(0,255,157,0)}100%{box-shadow:0 0 0 0 rgba(0,255,157,0)}}\n    @keyframes pulse2{0%{box-shadow:0 0 0 0 rgba(240,165,0,.3)}70%{box-shadow:0 0 0 14px rgba(240,165,0,0)}100%{box-shadow:0 0 0 0 rgba(240,165,0,0)}}\n    #oi{font-size:26px;pointer-events:none}\n    #tr{display:flex;gap:8px;width:100%;max-width:480px}\n    #ti{flex:1;background:var(--s);border:1px solid var(--b);border-radius:20px;\n      color:var(--t);padding:9px 14px;font-size:14px;outline:none;min-width:0}\n    #ti::placeholder{color:var(--d)}\n    #ti:focus{border-color:rgba(0,255,157,.35)}\n    #sb{background:rgba(0,255,157,.1);border:1px solid rgba(0,255,157,.25);border-radius:20px;\n      color:var(--g);padding:9px 14px;font-size:13px;cursor:pointer;\n      transition:background .15s;touch-action:manipulation;white-space:nowrap}\n    #sb:active{background:rgba(0,255,157,.2)}\n    #acts{display:flex;gap:8px}\n    .act{padding:5px 11px;border-radius:16px;font-size:11px;font-family:monospace;\n      border:1px solid var(--b);background:none;color:var(--m);cursor:pointer;\n      transition:all .15s;touch-action:manipulation}\n    .act:active{color:var(--t);border-color:rgba(255,255,255,.2)}\n    #sp{position:absolute;inset:0;background:rgba(10,12,15,.97);backdrop-filter:blur(14px);\n      z-index:20;display:flex;flex-direction:column;padding:22px 18px;gap:18px;\n      transform:translateX(100%);transition:transform .26s cubic-bezier(.4,0,.2,1)}\n    #sp.open{transform:translateX(0)}\n    .sph{display:flex;align-items:center;justify-content:space-between}\n    .spt{font-weight:700;font-size:16px}\n    #spc{background:none;border:none;cursor:pointer;color:var(--m);font-size:22px}\n    .sg label{display:block;font-size:11px;font-family:monospace;color:var(--m);\n      text-transform:uppercase;letter-spacing:.08em;margin-bottom:7px}\n    .sg select,.sg input{width:100%;background:var(--s);border:1px solid var(--b);\n      border-radius:10px;color:var(--t);padding:9px 12px;font-size:13px;outline:none;\n      -webkit-appearance:none;appearance:none}\n    .sg select:focus,.sg input[type="text"]:focus{border-color:rgba(0,255,157,.4)}\n    .sn{font-size:12px;color:var(--d);line-height:1.5}\n  </style>\n</head>\n<body>\n<div id="app">\n  <header>\n    <a class="logo" href="/">\n      <div class="li">G</div>\n      <span class="lt">God<span>Local</span> Voice</span>\n    </a>\n    <div class="hr">\n      <div id="dot" title="API status"></div>\n      <button id="sb-btn" onclick="openSettings()" aria-label="Settings">&#9881;</button>\n    </div>\n  </header>\n  <div id="chat">\n    <div id="empty">\n      <div class="ei">&#127897;&#65039;</div>\n      <p>Нажми кнопку и говори,<br/>или напечатай вопрос.</p>\n      <small>GodLocal AI · godlocal-api</small>\n    </div>\n  </div>\n  <div id="live"></div>\n  <div id="bot">\n    <div id="st">подключение…</div>\n    <div id="orb" role="button" aria-label="Speak"></div>\n    <div id="tr">\n      <input id="ti" type="text" placeholder="или напечатай здесь…" autocomplete="off" autocorrect="off" autocapitalize="off"/>\n      <button id="sb" onclick="sendText()">&#9658;</button>\n    </div>\n    <div id="acts">\n      <button class="act" id="mb" onclick="toggleMute()">&#128266; звук</button>\n      <button class="act" onclick="clearChat()">&#128465; очистить</button>\n    </div>\n  </div>\n  <div id="sp">\n    <div class="sph">\n      <span class="spt">&#9881; Настройки</span>\n      <button id="spc" onclick="closeSettings()">&#215;</button>\n    </div>\n    <div class="sg">\n      <label>Голос TTS</label>\n      <select id="vs" onchange="saveCfg()"></select>\n    </div>\n    <div class="sg">\n      <label>Скорость речи</label>\n      <input type="range" id="rs" min="0.6" max="1.6" step="0.1" value="1.0" oninput="saveCfg()"/>\n    </div>\n    <div class="sg">\n      <label>Персона</label>\n      <select id="ps" onchange="saveCfg()">\n        <option value="">Нет (обычный агент)</option>\n        <option value="j">Jarvis — точный и быстрый</option>\n        <option value="s">Sage — вдумчивый и глубокий</option>\n        <option value="w">WOLF — прямой, без воды</option>\n      </select>\n    </div>\n    <div class="sg">\n      <label>Язык распознавания</label>\n      <select id="ls" onchange="saveCfg()">\n        <option value="ru-RU">Русский</option>\n        <option value="en-US">English</option>\n      </select>\n    </div>\n    <p class="sn">Оранжевая точка = сервер просыпается (15-30 сек при первом запросе). Зелёная = готово.</p>\n  </div>\n</div>\n<script>\n(function(){\n\'use strict\';\n\nvar API=\'https://godlocal-api.onrender.com\';\nvar WS_URL=\'wss://godlocal-api.onrender.com/ws/chat\';\nvar PERSONA_PREFIXES={\n  j:\'[Respond as a precise concise AI. Max 3 sentences.] \',\n  s:\'[Respond thoughtfully and with depth.] \',\n  w:\'[WOLF mode: be blunt, direct, no fluff. Short.] \'\n};\nvar TIMEOUT_MS=20000;\n\nfunction ls(k){return localStorage.getItem(\'glv_\'+k)}\nfunction ss(k,v){localStorage.setItem(\'glv_\'+k,v)}\nvar cfg={voice:ls(\'vn\')||\'\',rate:parseFloat(ls(\'vr\')||\'1.0\'),persona:ls(\'vp\')||\'\',lang:ls(\'vl\')||\'ru-RU\',muted:ls(\'vm\')===\'1\'};\n\nvar ws=null,wsOk=false,warmedUp=false;\nvar rec=null,recActive=false;\nvar synth=window.speechSynthesis;\nvar voices=[];\nvar thinkId=null,speaking=false,streamTimer=null,responseTimer=null;\n\nvar $chat=document.getElementById(\'chat\');\nvar $empty=document.getElementById(\'empty\');\nvar $live=document.getElementById(\'live\');\nvar $st=document.getElementById(\'st\');\nvar $orb=document.getElementById(\'orb\');\nvar $dot=document.getElementById(\'dot\');\nvar $mb=document.getElementById(\'mb\');\nvar $ti=document.getElementById(\'ti\');\n\nfunction init(){\n  $orb.innerHTML=\'<span id="oi">&#8987;</span>\';\n  document.getElementById(\'rs\').value=cfg.rate;\n  document.getElementById(\'ps\').value=cfg.persona;\n  document.getElementById(\'ls\').value=cfg.lang;\n  updateMuteBtn();\n  loadVoices();\n  warmUp(connectWS);\n  $orb.addEventListener(\'click\',function(e){e.preventDefault();toggleListen();});\n  $ti.addEventListener(\'keydown\',function(e){if(e.key===\'Enter\'&&!e.shiftKey){e.preventDefault();sendText();}});\n}\n\n// ── WARM-UP ──────────────────────────────────────────────────────────\nfunction warmUp(cb){\n  setDot(\'warm\');setStatus(\'сервер просыпается…\',\'wm\');\n  $orb.className=\'wm\';document.getElementById(\'oi\').textContent=\'⏳\';\n  fetch(API+\'/api/health\',{cache:\'no-store\',signal:AbortSignal.timeout?AbortSignal.timeout(30000):undefined})\n    .then(function(){warmedUp=true;cb();})\n    .catch(function(){warmedUp=true;cb();});  // connect WS anyway\n}\n\n// ── WS ──────────────────────────────────────────────────────────────\nfunction connectWS(){\n  try{\n    if(ws){ws.onclose=null;try{ws.close();}catch(e){}}\n    setDot(\'\');\n    ws=new WebSocket(WS_URL);\n    ws.onopen=function(){\n      wsOk=true;setDot(\'on\');\n      if($orb.className===\'wm\'||$orb.className===\'er\'){\n        $orb.className=\'\';document.getElementById(\'oi\').textContent=\'&#127908;\';\n        setStatus(\'нажми чтобы говорить\');\n      }\n    };\n    ws.onerror=function(){wsOk=false;setDot(\'err\');};\n    ws.onclose=function(){wsOk=false;setDot(\'err\');setTimeout(connectWS,5000);};\n    ws.onmessage=handleToken;\n  }catch(ex){setDot(\'err\');}\n}\n\nfunction handleToken(e){\n  var tok=typeof e.data===\'string\'?e.data:\'\';\n  if(!tok)return;\n  clearTimeout(responseTimer);\n  if(thinkId){var el=document.getElementById(thinkId);if(el)el.remove();thinkId=null;}\n  var bbl=document.getElementById(\'streaming\');\n  if(!bbl){bbl=addMsg(\'a\',\'\',{id:\'streaming\'});}\n  var txt=bbl.querySelector(\'.btxt\');\n  txt.textContent=(txt.textContent||\'\')+tok;\n  scrollBot();\n  setStatus(\'получаю…\',\'tk\');\n  clearTimeout(streamTimer);\n  streamTimer=setTimeout(function(){\n    var el=document.getElementById(\'streaming\');\n    if(el){var t=el.querySelector(\'.btxt\').textContent.trim();el.removeAttribute(\'id\');if(t){setStatus(\'нажми чтобы говорить\');resetOrb();speak(t);}}\n  },800);\n}\n\nfunction sendToAgent(text){\n  if(!text)return;\n  addMsg(\'u\',text);\n  var p=cfg.persona;\n  var msg=p&&PERSONA_PREFIXES[p]?PERSONA_PREFIXES[p]+text:text;\n  thinkId=\'tk\'+Date.now();addThink(thinkId);setStatus(\'думаю…\',\'tk\');$orb.className=\'tk\';document.getElementById(\'oi\').textContent=\'&#x1F4AD;\';\n  responseTimer=setTimeout(function(){fallbackRest(msg);},TIMEOUT_MS);\n  var payload=JSON.stringify({message:msg,service_tokens:{}});\n  if(wsOk&&ws&&ws.readyState===1){\n    try{ws.send(payload);}catch(ex){clearTimeout(responseTimer);fallbackRest(msg);}\n  }else{clearTimeout(responseTimer);fallbackRest(msg);}\n}\n\n// ── REST FALLBACK via /think (confirmed 200) ─────────────────────────\n// FIX: prefix with conversational instruction to prevent tool-calling loop\nfunction fallbackRest(msg){\n  clearTimeout(responseTimer);\n  if(thinkId){var el=document.getElementById(thinkId);if(el)el.remove();thinkId=null;}\n  var ftk=\'ftk\'+Date.now();addThink(ftk);setStatus(\'через HTTP…\',\'tk\');\n  fetch(API+\'/think\',{\n    method:\'POST\',headers:{\'Content-Type\':\'application/json\'},\n    body:JSON.stringify({message:\'Just respond conversationally (no tools needed): \'+msg})\n  })\n  .then(function(r){if(!r.ok)throw new Error(\'HTTP \'+r.status);return r.json();})\n  .then(function(d){\n    var el=document.getElementById(ftk);if(el)el.remove();\n    var reply=d.response||d.message||d.text||\'\';\n    if(!reply)throw new Error(\'empty response\');\n    addMsg(\'a\',reply);setStatus(\'нажми чтобы говорить\');resetOrb();speak(reply);\n  })\n  .catch(function(err){\n    var el=document.getElementById(ftk);if(el)el.remove();\n    addMsg(\'a\',\'Нет ответа (\'+err.message+\'). Сервер мог спать — попробуй ещё раз.\',{cls:\'err\'});\n    setStatus(\'ошибка\',\'er\');$orb.className=\'er\';document.getElementById(\'oi\').textContent=\'&#x26A0;&#xFE0F;\';\n    setTimeout(resetOrb,3000);\n  });\n}\n\n// ── SPEECH RECOGNITION ──────────────────────────────────────────────\nfunction toggleListen(){\n  if(speaking){synth.cancel();speaking=false;}\n  if(recActive){stopRec();}else{startRec();}\n}\nfunction startRec(){\n  var SR=window.SpeechRecognition||window.webkitSpeechRecognition;\n  if(!SR){setStatus(\'Микрофон не поддерживается\',\'er\');$ti.focus();return;}\n  recActive=true;$orb.className=\'ls\';document.getElementById(\'oi\').textContent=\'&#x1F534;\';setStatus(\'слушаю…\',\'ls\');\n  rec=new SR();rec.continuous=false;rec.interimResults=true;rec.lang=cfg.lang;\n  rec.onresult=function(e){\n    var interim=\'\',final=\'\';\n    for(var i=e.resultIndex;i<e.results.length;i++){\n      if(e.results[i].isFinal)final+=e.results[i][0].transcript;\n      else interim+=e.results[i][0].transcript;\n    }\n    showLive(final||interim);\n    if(final){hideLive();stopRec(true);sendToAgent(final.trim());}\n  };\n  rec.onerror=function(e){\n    hideLive();recActive=false;\n    var msg=e.error===\'not-allowed\'?\'Нет доступа к микрофону\':e.error===\'no-speech\'?\'Не услышал — попробуй\':\'Ошибка: \'+e.error;\n    setStatus(msg,\'er\');resetOrb();setTimeout(function(){setStatus(\'нажми чтобы говорить\');},2500);\n  };\n  rec.onend=function(){if(recActive){recActive=false;resetOrb();}};\n  try{rec.start();}catch(ex){recActive=false;setStatus(\'Не удалось запустить микрофон\',\'er\');resetOrb();}\n}\nfunction stopRec(silent){recActive=false;if(rec){try{rec.stop();}catch(ex){}rec=null;}if(!silent)resetOrb();}\n\n// ── TTS ─────────────────────────────────────────────────────────────\nfunction loadVoices(){\n  function load(){\n    voices=synth.getVoices();\n    var sel=document.getElementById(\'vs\');sel.innerHTML=\'<option value="">Авто</option>\';\n    voices.forEach(function(v){var o=document.createElement(\'option\');o.value=v.name;o.textContent=v.name+\' (\'+v.lang+\')\';if(v.name===cfg.voice)o.selected=true;sel.appendChild(o);});\n  }\n  load();if(synth.onvoiceschanged!==undefined)synth.onvoiceschanged=load;\n}\nfunction speak(text){\n  if(cfg.muted||!text)return;\n  setStatus(\'говорю…\',\'sp\');$orb.className=\'sp\';document.getElementById(\'oi\').textContent=\'&#x1F50A;\';speaking=true;\n  var clean=text.replace(/[*_~#>` + \'`\' + `]/g,\'\').replace(/https?:\\/\\/\\S+/g,\'\').trim();\n  var chunks=[];var sents=clean.match(/[^.!?]+[.!?]*/g)||[clean];var cur=\'\';\n  sents.forEach(function(s){if((cur+s).length>160&&cur){chunks.push(cur.trim());cur=s;}else cur+=s;});\n  if(cur.trim())chunks.push(cur.trim());chunks=chunks.filter(Boolean);\n  var i=0;\n  function next(){\n    if(!speaking||i>=chunks.length){speaking=false;resetOrb();return;}\n    var u=new SpeechSynthesisUtterance(chunks[i++]);u.rate=cfg.rate;u.pitch=1.0;\n    if(cfg.voice){var vx=voices.find(function(v){return v.name===cfg.voice;});if(vx)u.voice=vx;}\n    u.onend=next;u.onerror=next;synth.speak(u);\n  }\n  next();\n}\n\n// ── UI HELPERS ───────────────────────────────────────────────────────\nfunction addMsg(role,text,opts){\n  if($empty)$empty.style.display=\'none\';\n  var wrap=document.createElement(\'div\');wrap.className=\'msg \'+role+(opts&&opts.cls?\' \'+opts.cls:\'\');\n  if(opts&&opts.id)wrap.id=opts.id;\n  var bbl=document.createElement(\'div\');bbl.className=\'bbl\';\n  var span=document.createElement(\'span\');span.className=\'btxt\';span.textContent=text;\n  bbl.appendChild(span);\n  var ts=document.createElement(\'div\');ts.className=\'ts\';ts.textContent=new Date().toLocaleTimeString([],{hour:\'2-digit\',minute:\'2-digit\'});\n  wrap.appendChild(bbl);wrap.appendChild(ts);$chat.appendChild(wrap);scrollBot();return wrap;\n}\nfunction addThink(id){\n  var w=document.createElement(\'div\');w.className=\'msg a\';w.id=id;\n  w.innerHTML=\'<div class="bbl"><div class="dots"><span></span><span></span><span></span></div></div>\';\n  $chat.appendChild(w);scrollBot();\n}\nfunction scrollBot(){$chat.scrollTop=$chat.scrollHeight;}\nfunction setStatus(t,cls){$st.textContent=t;$st.className=cls||\'\';}\nfunction setDot(cls){$dot.className=cls;}\nfunction showLive(t){$live.textContent=t;$live.className=\'on\';}\nfunction hideLive(){$live.textContent=\'\';$live.className=\'\';}\nfunction resetOrb(){\n  if(!thinkId&&!speaking){\n    $orb.className=\'\';\n    var oi=document.getElementById(\'oi\');if(oi)oi.textContent=\'&#127908;\';\n    setStatus(\'нажми чтобы говорить\');\n  }\n}\nwindow.sendText=function(){var v=$ti.value.trim();if(!v)return;$ti.value=\'\';if(speaking){synth.cancel();speaking=false;}sendToAgent(v);};\nwindow.toggleMute=function(){cfg.muted=!cfg.muted;ss(\'vm\',cfg.muted?\'1\':\'0\');if(cfg.muted){synth.cancel();speaking=false;resetOrb();}updateMuteBtn();};\nfunction updateMuteBtn(){$mb.textContent=cfg.muted?\'&#x1F507; без звука\':\'&#x1F50A; звук\';}\nwindow.clearChat=function(){\n  clearTimeout(streamTimer);clearTimeout(responseTimer);\n  if(rec){try{rec.stop();}catch(e){}}recActive=false;synth.cancel();speaking=false;\n  $chat.innerHTML=\'\';$chat.appendChild($empty);$empty.style.display=\'\';\n  setStatus(\'нажми чтобы говорить\');resetOrb();\n};\nwindow.openSettings=function(){document.getElementById(\'sp\').classList.add(\'open\');};\nwindow.closeSettings=function(){document.getElementById(\'sp\').classList.remove(\'open\');};\nwindow.saveCfg=function(){\n  cfg.voice=document.getElementById(\'vs\').value;cfg.rate=parseFloat(document.getElementById(\'rs\').value);\n  cfg.persona=document.getElementById(\'ps\').value;cfg.lang=document.getElementById(\'ls\').value;\n  ss(\'vn\',cfg.voice);ss(\'vr\',cfg.rate);ss(\'vp\',cfg.persona);ss(\'vl\',cfg.lang);\n};\ndocument.body.addEventListener(\'touchmove\',function(e){if(!e.target.closest(\'#chat\'))e.preventDefault();},{passive:false});\nwindow.addEventListener(\'load\',init);\n})();\n</script>\n</body>\n</html>';

export async function GET() {
  return new NextResponse(HTML, {
    headers: {
      'Content-Type': 'text/html; charset=utf-8',
      'Cache-Control': 'no-store, no-cache, must-revalidate',
    },
  });
}
