<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>WOLF ‚Äî –í–µ—Å—å —Ä—ã–Ω–æ–∫</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --bg:#06080c;--bg2:#0b0e16;--bg3:#10151f;--border:#1a2235;
  --g:#00FF9D;--r:#FF4466;--y:#F9CA24;--b:#00b4d8;--p:#7C6EE8;
  --gold:#FFD700;--o:#FF9000;
  --txt:#c5cee0;--dim:#4a5568;
}
html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--txt);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}
body{display:flex;flex-direction:column;padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom)}

/* TOP */
.top{display:flex;align-items:center;gap:8px;padding:8px 14px 6px;border-bottom:1px solid var(--border);flex-shrink:0}
.logo{font-size:17px;font-weight:900;letter-spacing:1.5px;background:linear-gradient(90deg,#FFD700 0%,#fff 50%,#FFD700 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-size:200% auto}
.logo-sub{font-size:9px;color:rgba(255,215,0,.55);letter-spacing:.6px;font-weight:700;line-height:1}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.2}}
.dot{width:7px;height:7px;border-radius:50%;background:var(--g);box-shadow:0 0 9px var(--g);flex-shrink:0;animation:pulse 2.2s infinite}
.dot.dead{background:var(--r);box-shadow:0 0 9px var(--r);animation:none}
.strip{flex:1;font-size:10px;color:var(--dim);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;padding:0 6px;cursor:pointer}
.k{padding:2px 8px;border-radius:6px;border:1px solid rgba(255,68,102,.35);color:var(--r);font-size:10px;font-weight:700;background:transparent;cursor:pointer;flex-shrink:0}
.k.on{background:var(--r);color:#fff;border-color:var(--r)}

/* CHIPS */
.chips{display:flex;gap:5px;padding:7px 12px;overflow-x:auto;scrollbar-width:none;border-bottom:1px solid var(--border);flex-shrink:0}
.chips::-webkit-scrollbar{display:none}
.ch{white-space:nowrap;padding:5px 10px;border-radius:20px;font-size:11px;font-weight:600;cursor:pointer;border:1px solid var(--border);color:var(--dim);background:var(--bg2);transition:all .15s;flex-shrink:0;position:relative}
.ch:active{transform:scale(.93)}
.ch.sol{border-color:rgba(0,255,157,.3);color:var(--g)}
.ch.pump{border-color:rgba(255,144,0,.3);color:var(--o)}
.ch.crypt{border-color:rgba(255,215,0,.3);color:var(--gold)}
.ch.stk{border-color:rgba(0,180,216,.3);color:var(--b)}
.ch.fx{border-color:rgba(124,110,232,.3);color:var(--p)}
.ch.fg{border-color:rgba(255,68,102,.3);color:var(--r)}
.ch.bag{border-color:rgba(0,255,157,.25);color:var(--g)}
.ch.wolf{border-color:rgba(255,215,0,.4);color:var(--gold);font-weight:800;background:rgba(255,215,0,.04)}
.ch.flt{border-color:rgba(249,202,36,.28);color:var(--y)}

/* FILTERS */
.fp{display:none;padding:9px 13px;border-bottom:1px solid var(--border);background:var(--bg2);flex-shrink:0}
.fp.open{display:block}
.fr{display:flex;gap:5px;flex-wrap:wrap;align-items:center;margin-bottom:7px}
.fr:last-child{margin:0}
.fl{font-size:10px;color:var(--dim);min-width:60px;font-weight:700;text-transform:uppercase;letter-spacing:.3px}
.fb{padding:3px 9px;border-radius:12px;font-size:11px;font-weight:600;cursor:pointer;border:1px solid var(--border);color:var(--dim);background:transparent}
.fb.on{border-color:var(--gold);color:var(--gold);background:rgba(255,215,0,.07)}

/* CHAT */
.chat{flex:1;overflow-y:auto;overflow-x:hidden;padding:10px 12px 8px;display:flex;flex-direction:column;gap:10px;scrollbar-width:thin;scrollbar-color:var(--border) transparent}

/* BUBBLES */
.msg{display:flex;flex-direction:column;gap:3px}
.msg.u{align-items:flex-end}
.bb{padding:9px 13px;border-radius:16px;font-size:13px;line-height:1.55;word-break:break-word;max-width:95%}
.bb.ai{background:var(--bg2);border:1px solid var(--border);border-radius:16px 16px 16px 4px}
.bb.u{background:rgba(124,110,232,.14);border:1px solid rgba(124,110,232,.25);border-radius:16px 16px 4px 16px;color:#c5bff8}
.bb.wolf{border-left:3px solid var(--gold);background:rgba(255,215,0,.04)}
@keyframes blink{0%,80%,100%{opacity:0}40%{opacity:1}}
.dots span{animation:blink 1.4s infinite both;font-size:18px;line-height:.8}
.dots span:nth-child(2){animation-delay:.2s}
.dots span:nth-child(3){animation-delay:.4s}

/* CARD */
.card{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:9px 11px;margin-top:6px}
.card+.card{margin-top:5px}
.card.buy{border-color:rgba(0,255,157,.2)}
.card.sell{border-color:rgba(255,68,102,.2)}
.card.pmp{border-color:rgba(255,144,0,.22)}
.card-h{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:5px}
.csym{font-weight:800;font-size:14px;color:#fff}
.cname{font-size:10px;color:var(--dim);margin-top:1px;max-width:130px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.cpr{text-align:right}
.price{font-size:13px;font-weight:700;color:#fff}
.chg{font-size:11px;font-weight:700}
.pos{color:var(--g)}.neg{color:var(--r)}.neu{color:var(--dim)}
.stats{display:flex;gap:8px;flex-wrap:wrap;margin-top:4px}
.s{display:flex;flex-direction:column}
.sl{font-size:9px;color:var(--dim);text-transform:uppercase;letter-spacing:.3px}
.sv{font-size:11px;font-weight:600;color:var(--txt)}
.bg{display:inline-block;padding:1px 6px;border-radius:5px;font-size:10px;font-weight:700;margin-left:4px}
.bg-buy{background:rgba(0,255,157,.12);color:var(--g);border:1px solid rgba(0,255,157,.25)}
.bg-sell{background:rgba(255,68,102,.1);color:var(--r);border:1px solid rgba(255,68,102,.22)}
.bg-hold{background:rgba(249,202,36,.08);color:var(--y);border:1px solid rgba(249,202,36,.2)}
.bg-new{background:rgba(0,180,216,.08);color:var(--b);border:1px solid rgba(0,180,216,.2)}
.bg-pmp{background:rgba(255,144,0,.1);color:var(--o);border:1px solid rgba(255,144,0,.2)}
.prog{height:3px;background:var(--border);border-radius:3px;overflow:hidden;margin-top:5px}
.prog-f{height:100%;border-radius:3px}
.cbs{display:flex;gap:5px;margin-top:7px;flex-wrap:wrap}
.cb{padding:4px 9px;border-radius:7px;font-size:10px;font-weight:600;cursor:pointer;border:none}
.cb-g{background:rgba(0,255,157,.12);color:var(--g);border:1px solid rgba(0,255,157,.22)}
.cb-p{background:rgba(124,110,232,.12);color:var(--p);border:1px solid rgba(124,110,232,.2)}
.cb-r{background:rgba(255,68,102,.1);color:var(--r);border:1px solid rgba(255,68,102,.2)}
.cb-o{background:rgba(255,144,0,.1);color:var(--o);border:1px solid rgba(255,144,0,.2)}
.cb-gold{background:rgba(255,215,0,.1);color:var(--gold);border:1px solid rgba(255,215,0,.22)}

/* WOLF QUOTE */
.wq{border-left:3px solid var(--gold);background:rgba(255,215,0,.04);border-radius:0 8px 8px 0;padding:8px 12px;margin:8px 0 2px;font-style:italic;font-size:12px;color:rgba(255,215,0,.85);line-height:1.5}

/* HOLDERS */
.hrow{display:flex;justify-content:space-between;align-items:center;padding:4px 0;border-bottom:1px solid var(--border)}
.hrow:last-child{border:none}

/* FNG RING */
.fng-ring{width:76px;height:76px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;border-width:4px;border-style:solid}
.fng-n{font-size:22px;font-weight:900;line-height:1}
.fng-l{font-size:8px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;margin-top:2px}

/* SECTION TITLE */
.sec{font-size:10px;font-weight:700;color:var(--dim);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}

/* RUG BAR */
.rug-b{height:4px;background:var(--border);border-radius:3px;overflow:hidden;margin-top:4px}
.rug-f{height:100%;border-radius:3px}

/* PORTFOLIO ROW */
.prow{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:8px 11px;margin-top:5px;display:flex;justify-content:space-between;align-items:center}

/* MARKET TABLE */
.mt{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:9px 12px;margin-top:6px}
.mr{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid var(--border)}
.mr:last-child{border:none}
.mn{font-size:12px;font-weight:700;color:#fff}
.ms{font-size:10px;color:var(--dim)}
.mp{text-align:right}
.mv{font-size:13px;font-weight:700;color:#fff}

/* SETUP BANNER */
.setup{background:rgba(255,215,0,.06);border:1px solid rgba(255,215,0,.2);border-radius:10px;padding:10px 12px;margin-top:6px;font-size:12px}

/* INPUT */
.iw{padding:8px 12px;padding-bottom:calc(8px + env(safe-area-inset-bottom));border-top:1px solid var(--border);background:var(--bg);flex-shrink:0}
.ir{display:flex;gap:7px;align-items:flex-end}
.inp{flex:1;background:var(--bg2);border:1px solid var(--border);border-radius:13px;padding:9px 13px;color:#fff;font-size:14px;outline:none;resize:none;font-family:inherit;line-height:1.4;max-height:110px}
.inp:focus{border-color:rgba(255,215,0,.5)}
.inp::placeholder{color:var(--dim)}
.snd{background:linear-gradient(135deg,var(--gold) 0%,var(--o) 100%);color:#000;border:none;border-radius:11px;padding:9px 15px;font-size:17px;cursor:pointer;flex-shrink:0;font-weight:900}
.snd:active{opacity:.75}

@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<div class="top">
  <div class="dot" id="dot"></div>
  <div><div class="logo">üê∫ WOLF</div><div class="logo-sub">–í–ï–°–¨ –†–´–ù–û–ö ¬∑ 24/7</div></div>
  <div class="strip" id="strip" onclick="cmd('–∫—Ä–∏–ø—Ç–æ')">‚Ä¶</div>
  <button class="k" id="kb" onclick="toggleKill()">‚ò†</button>
</div>

<div class="chips">
  <div class="ch sol" onclick="cmd('—Å–∫–∞–Ω')">üå™Ô∏è Solana</div>
  <div class="ch pump" onclick="cmd('pump')">üî• Pump</div>
  <div class="ch crypt" onclick="cmd('–∫—Ä–∏–ø—Ç–æ')">‚Çø –ö—Ä–∏–ø—Ç–æ</div>
  <div class="ch stk" onclick="cmd('–∞–∫—Ü–∏–∏')">üìä –ê–∫—Ü–∏–∏</div>
  <div class="ch fx" onclick="cmd('—Ñ–æ—Ä–µ–∫—Å')">üí± –§–æ—Ä–µ–∫—Å</div>
  <div class="ch fg" onclick="cmd('—Ñ–Ω–≥')">üò± F&G</div>
  <div class="ch bag" onclick="cmd('–±–∞–≥')">üíº –ü–æ—Ä—Ç—Ñ–µ–ª—å</div>
  <div class="ch flt" id="fch" onclick="toggleFlt()">‚öôÔ∏è –§–∏–ª—å—Ç—Ä—ã</div>
  <div class="ch wolf" onclick="cmd('wolf')">üê∫ WOLF</div>
</div>

<div class="fp" id="fp">
  <div class="fr">
    <span class="fl">MCap</span>
    <div class="fb on" onclick="sf('mc',0,this)">–õ—é–±–æ–π</div>
    <div class="fb" onclick="sf('mc',50000,this)">&lt;50K</div>
    <div class="fb" onclick="sf('mc',200000,this)">&lt;200K</div>
    <div class="fb" onclick="sf('mc',1000000,this)">&lt;1M</div>
  </div>
  <div class="fr">
    <span class="fl">–õ–∏–∫–≤.</span>
    <div class="fb on" onclick="sf('lq',0,this)">–õ—é–±–∞—è</div>
    <div class="fb" onclick="sf('lq',5000,this)">&gt;$5K</div>
    <div class="fb" onclick="sf('lq',20000,this)">&gt;$20K</div>
    <div class="fb" onclick="sf('lq',50000,this)">&gt;$50K</div>
  </div>
  <div class="fr">
    <span class="fl">–í–æ–∑—Ä–∞—Å—Ç</span>
    <div class="fb on" onclick="sf('ag',0,this)">–õ—é–±–æ–π</div>
    <div class="fb" onclick="sf('ag',30,this)">&lt;30m</div>
    <div class="fb" onclick="sf('ag',120,this)">&lt;2h</div>
    <div class="fb" onclick="sf('ag',360,this)">&lt;6h</div>
    <div class="fb" onclick="sf('sig','buy',this)">üü¢ BUY only</div>
  </div>
</div>

<div class="chat" id="chat"></div>

<div class="iw">
  <div class="ir">
    <textarea class="inp" id="inp" rows="1"
      placeholder="BTC –∫—É–¥–∞? NVDA –ø—Ä–æ–¥–∞–≤–∞—Ç—å? –õ—É—á—à–∏–π –º–µ–º —Å–µ–≥–æ–¥–Ω—è?"
      onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();send()}"
      oninput="this.style.height='auto';this.style.height=Math.min(this.scrollHeight,110)+'px'"></textarea>
    <button class="snd" onclick="send()">‚Üë</button>
  </div>
</div>

<script>
'use strict';
const DEX='https://api.dexscreener.com';
const SOL_RPC='https://api.mainnet-beta.solana.com';
const CG='https://api.coingecko.com/api/v3';
const FNG_URL='https://api.alternative.me/fng/?limit=7';
const FX_URL='https://api.frankfurter.app/latest';
const GROQ_URL='https://api.groq.com/openai/v1/chat/completions';

let killed=false, portfolio=JSON.parse(localStorage.getItem('gl_portfolio')||'[]');
let pushed=new Set(JSON.parse(localStorage.getItem('gl_pushed')||'[]'));
let flt={mc:0,lq:0,ag:0,sig:'all'};
let mktCtx={btc:0,eth:0,sol:0,fng:50,fngLbl:'Neutral',mkt24h:0};
let tgBot=localStorage.getItem('gl_telegram')||'';
let tgChat=localStorage.getItem('gl_tg_chat')||'';
let autoTimer=null;

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
const f$=v=>{if(!v||isNaN(v))return'‚Äì';if(v>=1e12)return'$'+(v/1e12).toFixed(2)+'T';if(v>=1e9)return'$'+(v/1e9).toFixed(2)+'B';if(v>=1e6)return'$'+(v/1e6).toFixed(2)+'M';if(v>=1e3)return'$'+(v/1e3).toFixed(1)+'K';return v>=0.01?'$'+v.toFixed(4):'$'+v.toExponential(2)};
const fa=ms=>{const m=Math.floor(ms/60000);return m<60?m+'m':m<1440?Math.floor(m/60)+'h':Math.floor(m/1440)+'d'};
const cl=v=>v>0?'pos':v<0?'neg':'neu';
const cs=v=>v===undefined||isNaN(v)?'‚Äì%':(v>0?'+':'')+v.toFixed(1)+'%';
const esc=s=>String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
const $chat=()=>document.getElementById('chat');
const scroll=()=>requestAnimationFrame(()=>{const c=$chat();c.scrollTop=c.scrollHeight});

// ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ
function toggleFlt(){document.getElementById('fp').classList.toggle('open')}
function sf(k,v,el){flt[k]=v;el.closest('.fr').querySelectorAll('.fb').forEach(b=>b.classList.remove('on'));el.classList.add('on')}
function applyF(pairs){return pairs.filter(p=>{const mc=p.fdv||p.marketCap||0,lq=p.liquidity?.usd||0,ag=p.pairCreatedAt?Math.floor((Date.now()-p.pairCreatedAt)/60000):9999;if(flt.mc&&mc>flt.mc)return false;if(flt.lq&&lq<flt.lq)return false;if(flt.ag&&ag>flt.ag)return false;if(flt.sig==='buy'&&sigT(score(p))!=='buy')return false;return true})}

// ‚îÄ‚îÄ KILL ‚îÄ‚îÄ
function toggleKill(){killed=!killed;document.getElementById('kb').classList.toggle('on',killed);document.getElementById('dot').classList.toggle('dead',killed);if(killed){clearInterval(autoTimer);bot('‚ò†Ô∏è –£–±–∏—Ç. –î–µ–Ω—å–≥–∏ –Ω–µ –¥–≤–∏–≥–∞—é—Ç—Å—è.')}else{startAuto();bot('üê∫ –°–Ω–æ–≤–∞ –≤ –¥–µ–ª–µ.')}}

// ‚îÄ‚îÄ SCORE ‚îÄ‚îÄ
function score(p){const c5=+p.priceChange?.m5||0,c1=+p.priceChange?.h1||0,vol=p.volume?.h24||0,mc=p.fdv||p.marketCap||0,lq=p.liquidity?.usd||0,ag=p.pairCreatedAt?Date.now()-p.pairCreatedAt:null,b=p.txns?.h24?.buys||0,s=p.txns?.h24?.sells||0;let sc=50;if(c5>5)sc+=12;if(c5<-5)sc-=18;if(c1>20)sc+=18;if(c1<-20)sc-=22;if(mc>0){const r=vol/mc;if(r>.5)sc+=14;if(r<.05)sc-=10}if(lq<5000)sc-=25;else if(lq>50000)sc+=8;if(ag&&ag<2*3600000&&c5>0)sc+=12;if(b>s*1.5)sc+=10;if(s>b*2)sc-=15;if(mc<500000&&mc>0)sc+=12;if(mc>5000000)sc-=8;return Math.max(0,Math.min(100,Math.round(sc)))}
function sigT(s){return s>=68?'buy':s<=32?'sell':'hold'}

// ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ
function bot(html,wolfClass=false){const d=document.createElement('div');d.className='msg';d.innerHTML=`<div class="bb ai${wolfClass?' wolf':''}">${html}</div>`;$chat().appendChild(d);scroll();return d}
function userBbl(t){const d=document.createElement('div');d.className='msg u';d.innerHTML=`<div class="bb u">${esc(t)}</div>`;$chat().appendChild(d);scroll()}
function typing(){const d=document.createElement('div');d.className='msg';d.id='tp';d.innerHTML='<div class="bb ai"><div class="dots"><span>‚óè</span><span>‚óè</span><span>‚óè</span></div></div>';$chat().appendChild(d);scroll()}
function rmTp(){const t=document.getElementById('tp');if(t)t.remove()}

// ‚îÄ‚îÄ TOKEN CARD ‚îÄ‚îÄ
function tokenCard(p,extra=''){
  const sym=p.baseToken?.symbol||'?',nm=p.baseToken?.name||'';
  const pr=+p.priceUsd||0,c5=+p.priceChange?.m5||0,c1=+p.priceChange?.h1||0;
  const v1=p.volume?.h1||0,mc=p.fdv||p.marketCap||0,lq=p.liquidity?.usd||0;
  const b=p.txns?.h24?.buys||0,s=p.txns?.h24?.sells||0;
  const ag=p.pairCreatedAt?Date.now()-p.pairCreatedAt:null;
  const sc=score(p),st=sigT(sc),sc_=st==='buy'?'var(--g)':st==='sell'?'var(--r)':'var(--y)';
  const bp=b+s>0?Math.round(b/(b+s)*100):50;
  const addr=p.baseToken?.address||'',url=p.url||'https://dexscreener.com/solana/'+(p.pairAddress||'');
  return `<div class="card ${st}">
    <div class="card-h">
      <div><div class="csym">${esc(sym)}<span class="bg bg-${st}">${st==='buy'?'üü¢ BUY':st==='sell'?'üî¥ SELL':'üü° HOLD'}</span>${ag&&ag<4*36e5?'<span class="bg bg-new">NEW</span>':''}</div>
      <div class="cname">${esc(nm)}${ag?' ¬∑ ‚è± '+fa(ag):''}</div></div>
      <div class="cpr"><div class="price">${f$(pr)}</div><div class="chg ${cl(c1)}">${cs(c1)} 1h</div></div>
    </div>
    <div class="stats">
      <div class="s"><div class="sl">MCap</div><div class="sv">${f$(mc)}</div></div>
      <div class="s"><div class="sl">Vol 1h</div><div class="sv">${f$(v1)}</div></div>
      <div class="s"><div class="sl">–õ–∏–∫–≤.</div><div class="sv" style="${lq<3000?'color:var(--r)':''}">${f$(lq)}</div></div>
      <div class="s"><div class="sl">B/S</div><div class="sv" style="color:${bp>55?'var(--g)':'var(--r)'}">${b}/${s}</div></div>
      <div class="s"><div class="sl">5m</div><div class="sv chg ${cl(c5)}">${cs(c5)}</div></div>
    </div>
    <div class="prog"><div class="prog-f" style="width:${sc}%;background:${sc_}"></div></div>
    <div class="cbs">
      <button class="cb cb-g" onclick="addBag('${esc(addr)}','${esc(sym)}',${pr})">+–í–æ–π—Ç–∏</button>
      <button class="cb cb-p" onclick="cmd('–∞–Ω–∞–ª–∏–∑ ${esc(addr)}')">On-Chain</button>
      ${tgBot&&tgChat?`<button class="cb cb-o" onclick="pushTg('${esc(sym)}','${esc(addr)}',${c1},${v1},${lq},${b},${s},${ag||0})">üì§ TG</button>`:''}
      <a href="${url}" target="_blank" style="text-decoration:none"><button class="cb cb-p">DEX ‚Üó</button></a>
      ${extra}
    </div>
  </div>`;
}

// ‚îÄ‚îÄ SCAN ‚îÄ‚îÄ
async function runScan(){
  if(killed)return;typing();
  try{
    const [boosts,srch]=await Promise.all([
      fetch(DEX+'/token-boosts/latest/v1').then(r=>r.json()).catch(()=>[]),
      fetch(DEX+'/latest/dex/search?q=solana&rankBy=trendingScoreH6&order=desc').then(r=>r.json()).catch(()=>({pairs:[]}))
    ]);
    const addrs=(Array.isArray(boosts)?boosts:[]).filter(x=>x.chainId==='solana').slice(0,14).map(x=>x.tokenAddress);
    let pairs=[];
    if(addrs.length){const r=await fetch(DEX+'/latest/dex/tokens/'+addrs.join(',')).then(x=>x.json());pairs=(r.pairs||[]).filter(p=>p.chainId==='solana')}
    const sp=(srch.pairs||[]).filter(p=>p.chainId==='solana').slice(0,8);
    const seen=new Set();
    let all=[...pairs,...sp].filter(p=>{const a=p.baseToken?.address;if(!a||seen.has(a))return false;seen.add(a);return true}).sort((a,b)=>score(b)-score(a));
    rmTp();
    const filt=applyF(all);
    document.getElementById('strip').textContent=all.slice(0,5).map(p=>`${p.baseToken?.symbol} ${(+p.priceChange?.h1||0)>0?'‚ñ≤':'‚ñº'}${Math.abs(+p.priceChange?.h1||0).toFixed(0)}%`).join(' ¬∑ ');
    const top=filt.slice(0,5);
    if(!top.length){bot(`üå™Ô∏è –°–∫–∞–Ω: ${all.length} —Ç–æ–∫–µ–Ω–æ–≤ ‚Äî –≤—Å–µ –æ—Ç—Ä–µ–∑–∞–Ω—ã —Ñ–∏–ª—å—Ç—Ä–æ–º.`);return}
    const d=document.createElement('div');d.className='msg';
    const buySc=filt.filter(p=>sigT(score(p))==='buy').length;
    d.innerHTML=`<div class="bb ai">üå™Ô∏è <b>Solana —Å–∫–∞–Ω</b> ¬∑ ${new Date().toLocaleTimeString('ru',{hour:'2-digit',minute:'2-digit'})} ¬∑ ${filt.length}/${all.length} —Ç–æ–∫–µ–Ω–æ–≤ ¬∑ üü¢ ${buySc} BUY${top.map(p=>tokenCard(p)).join('')}</div>`;
    $chat().appendChild(d);scroll();
    const newBuys=filt.filter(p=>sigT(score(p))==='buy'&&!pushed.has(p.baseToken?.address||'')).slice(0,3);
    if(newBuys.length)autoTgPush(newBuys);
  }catch(e){rmTp();bot('‚ö†Ô∏è –°–∫–∞–Ω: '+esc(e.message))}
}

// ‚îÄ‚îÄ PUMP ‚îÄ‚îÄ
async function runPump(){
  typing();
  try{
    const r=await fetch('https://frontend-api.pump.fun/coins?offset=0&limit=50&sort=created_timestamp&order=DESC&includeNsfw=false').then(x=>x.json());
    rmTp();
    if(!Array.isArray(r)){bot('üî• pump.fun CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω.<br>–û—Ç–∫—Ä–æ–π <a href="https://pump.fun" target="_blank" style="color:var(--o)">pump.fun ‚Üó</a> –∏–ª–∏ –¥–æ–±–∞–≤—å –ø—Ä–æ–∫—Å–∏ –Ω–∞ –±—ç–∫–µ–Ω–¥.');return}
    const now=Date.now();
    const fr=r.filter(c=>c.created_timestamp&&now-c.created_timestamp*1000<600000&&!c.complete).slice(0,6);
    if(!fr.length){bot('üî• pump.fun: –Ω–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ < 10 –º–∏–Ω. –ñ–¥–∏.');return}
    const d=document.createElement('div');d.className='msg';
    d.innerHTML='<div class="bb ai">üî• <b>pump.fun ¬∑ –∂–∏–≤—ã–µ &lt;10 –º–∏–Ω</b>'+fr.map(c=>{
      const ag=now-c.created_timestamp*1000,pr=Math.min(100,Math.round((c.usd_market_cap||0)/69000*100)),addr=c.mint||'';
      return `<div class="card pmp"><div class="card-h"><div><div class="csym">${esc(c.symbol||'?')}<span class="bg bg-pmp">üî• PUMP</span></div><div class="cname">${esc(c.name||'')} ¬∑ ‚è± ${fa(ag)}</div></div><div class="cpr"><div class="sv">${f$(c.usd_market_cap||0)}</div><div class="sl">mcap</div></div></div><div style="font-size:10px;color:var(--dim);margin-bottom:3px">Bonding curve ${pr}% ‚Üí $69K –ª–∏—Å—Ç–∏–Ω–≥</div><div class="prog"><div class="prog-f" style="width:${pr}%;background:linear-gradient(90deg,var(--o),var(--gold))"></div></div><div class="cbs"><button class="cb cb-g" onclick="addBag('${addr}','${esc(c.symbol||'?')}',0)">+–í–æ–π—Ç–∏</button><a href="https://pump.fun/${addr}" target="_blank" style="text-decoration:none"><button class="cb cb-o">pump.fun ‚Üó</button></a></div></div>`;
    }).join('')+'</div>';
    $chat().appendChild(d);scroll();
  }catch(e){rmTp();bot('‚ö†Ô∏è pump.fun: '+esc(e.message))}
}

// ‚îÄ‚îÄ CRYPTO ‚îÄ‚îÄ
async function runCrypto(){
  typing();
  try{
    const [coins,glob,fng]=await Promise.all([
      fetch(CG+'/coins/markets?vs_currency=usd&ids=bitcoin,ethereum,solana,binancecoin,ripple&order=market_cap_desc&price_change_percentage=1h,24h,7d').then(r=>r.json()),
      fetch(CG+'/global').then(r=>r.json()).catch(()=>null),
      fetch(FNG_URL).then(r=>r.json()).catch(()=>null)
    ]);
    rmTp();
    const fv=parseInt(fng?.data?.[0]?.value||50);
    const fl=fng?.data?.[0]?.value_classification||'Neutral';
    const fc=fv>=70?'var(--g)':fv>=50?'var(--y)':fv>=30?'var(--o)':'var(--r)';
    // update context
    const btc=coins.find(c=>c.id==='bitcoin'),sol=coins.find(c=>c.id==='solana'),eth=coins.find(c=>c.id==='ethereum');
    if(btc)mktCtx.btc=btc.current_price;if(eth)mktCtx.eth=eth.current_price;
    if(sol){mktCtx.sol=sol.current_price;mktCtx.solTrend=sol.price_change_percentage_24h}
    mktCtx.fng=fv;mktCtx.fngLbl=fl;
    if(glob?.data) mktCtx.mkt24h=glob.data.market_cap_change_percentage_24h_usd||0;
    const dom=(glob?.data?.market_cap_percentage?.btc||0).toFixed(1);
    const cards=coins.map(c=>{
      const c1=c.price_change_percentage_1h_in_currency||0,c24=c.price_change_percentage_24h||0,c7=c.price_change_percentage_7d_in_currency||0;
      const st=c24>3?'buy':c24<-3?'sell':'hold';
      return `<div class="card ${st}"><div class="card-h"><div><div class="csym">${esc(c.symbol?.toUpperCase())}<span class="bg bg-${st}">${st==='buy'?'üü¢ UP':st==='sell'?'üî¥ DOWN':'üü° FLAT'}</span></div><div class="cname">${esc(c.name)} ¬∑ #${c.market_cap_rank}</div></div><div class="cpr"><div class="price">$${c.current_price?.toLocaleString('en')}</div><div class="chg ${cl(c24)}">${cs(c24)} 24h</div></div></div><div class="stats"><div class="s"><div class="sl">1h</div><div class="sv chg ${cl(c1)}">${cs(c1)}</div></div><div class="s"><div class="sl">7d</div><div class="sv chg ${cl(c7)}">${cs(c7)}</div></div><div class="s"><div class="sl">MCap</div><div class="sv">${f$(c.market_cap)}</div></div><div class="s"><div class="sl">Vol24h</div><div class="sv">${f$(c.total_volume)}</div></div></div><div class="cbs"><button class="cb cb-gold" onclick="wolfQ('${esc(c.symbol?.toUpperCase())} —Å–µ–π—á–∞—Å $${c.current_price?.toLocaleString('en')}, –∑–∞ 24h ${cs(c24)}. –ö—Ä–∞—Ç–∫–æ: –∫—É–ø–∏—Ç—å, –ø—Ä–æ–¥–∞—Ç—å –∏–ª–∏ –∂–¥–∞—Ç—å?')">üê∫ –í–æ–ª–∫</button></div></div>`;
    }).join('');
    const d=document.createElement('div');d.className='msg';
    d.innerHTML=`<div class="bb ai">‚Çø <b>–ö—Ä–∏–ø—Ç–æ</b> ¬∑ F&G <span style="color:${fc};font-weight:700">${fv} ${fl}</span> ¬∑ BTC dom ${dom}% ¬∑ —Ä—ã–Ω–æ–∫ <span class="chg ${cl(mktCtx.mkt24h)}">${cs(mktCtx.mkt24h)} 24h</span>${cards}</div>`;
    $chat().appendChild(d);scroll();
    // auto strip update
    document.getElementById('strip').textContent=`BTC $${(mktCtx.btc||0).toLocaleString('en')} ¬∑ ETH $${(mktCtx.eth||0).toLocaleString('en')} ¬∑ SOL $${(mktCtx.sol||0).toFixed(1)} ¬∑ F&G ${fv}`;
  }catch(e){rmTp();bot('‚ö†Ô∏è CoinGecko: '+esc(e.message))}
}

// ‚îÄ‚îÄ STOCKS ‚îÄ‚îÄ
async function runStocks(){
  typing();
  const tickers=['NVDA','TSLA','AAPL','META','AMZN','MSFT'];
  try{
    const res=await Promise.allSettled(tickers.map(t=>fetch(`https://query2.finance.yahoo.com/v8/finance/chart/${t}?interval=1d&range=2d&corsDomain=finance.yahoo.com`).then(r=>r.json())));
    rmTp();
    const valid=res.filter(r=>r.status==='fulfilled'&&r.value?.chart?.result?.[0]).map(r=>{
      const m=r.value.chart.result[0].meta||{};
      const cur=m.regularMarketPrice||0,prev=m.previousClose||cur;
      const chg=prev?(cur-prev)/prev*100:0;
      return{sym:m.symbol,cur,chg,mc:m.marketCap,lo52:m.fiftyTwoWeekLow,hi52:m.fiftyTwoWeekHigh,nm:m.shortName||m.symbol};
    });
    if(!valid.length){
      const d=document.createElement('div');d.className='msg';
      d.innerHTML=`<div class="bb ai">üìä <b>–ê–∫—Ü–∏–∏</b><br><br>Yahoo Finance CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
        <div class="wq">–°–ø—Ä–æ—Å–∏ –º–µ–Ω—è –Ω–∞–ø—Ä—è–º—É—é: "—á—Ç–æ –¥—É–º–∞–µ—à—å –ø–æ NVDA" ‚Äî –æ—Ç–≤–µ—á—É —Å –∞–Ω–∞–ª–∏–∑–æ–º.</div>
        <div class="cbs"><a href="https://finance.yahoo.com" target="_blank" style="text-decoration:none"><button class="cb cb-p">Yahoo Finance ‚Üó</button></a><a href="https://finviz.com" target="_blank" style="text-decoration:none"><button class="cb cb-gold">Finviz ‚Üó</button></a><button class="cb cb-gold" onclick="wolfQ('–ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑ NVDA, TSLA, META, AAPL –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ. –ì–¥–µ —Ä–∏—Å–∫, –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å?')">üê∫ –í–æ–ª–∫ –ø–æ –∞–∫—Ü–∏—è–º</button></div></div>`;
      $chat().appendChild(d);scroll();return;
    }
    const cards=valid.map(s=>{
      const st=s.chg>1?'buy':s.chg<-1?'sell':'hold';
      return `<div class="card ${st}"><div class="card-h"><div><div class="csym">${esc(s.sym)}<span class="bg bg-${st}">${st==='buy'?'üü¢ UP':st==='sell'?'üî¥ DOWN':'üü° FLAT'}</span></div><div class="cname">${esc(s.nm)}</div></div><div class="cpr"><div class="price">$${s.cur.toFixed(2)}</div><div class="chg ${cl(s.chg)}">${cs(s.chg)} 1d</div></div></div><div class="stats"><div class="s"><div class="sl">MCap</div><div class="sv">${f$(s.mc)}</div></div><div class="s"><div class="sl">52W ‚¨Ü</div><div class="sv">$${s.hi52?.toFixed(0)||'‚Äì'}</div></div><div class="s"><div class="sl">52W ‚¨á</div><div class="sv">$${s.lo52?.toFixed(0)||'‚Äì'}</div></div></div><div class="cbs"><button class="cb cb-gold" onclick="wolfQ('${esc(s.sym)}: $${s.cur.toFixed(2)}, –∏–∑–º–µ–Ω–µ–Ω–∏–µ ${cs(s.chg)}, mcap ${f$(s.mc)}. –§–ª–∏–ø–ø –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å?')">üê∫ –í–æ–ª–∫</button><a href="https://finance.yahoo.com/quote/${esc(s.sym)}" target="_blank" style="text-decoration:none"><button class="cb cb-p">Yahoo ‚Üó</button></a></div></div>`;
    }).join('');
    const d=document.createElement('div');d.className='msg';
    d.innerHTML=`<div class="bb ai">üìä <b>–ê–∫—Ü–∏–∏</b>${cards}</div>`;
    $chat().appendChild(d);scroll();
  }catch(e){rmTp();bot('‚ö†Ô∏è –ê–∫—Ü–∏–∏: '+esc(e.message))}
}

// ‚îÄ‚îÄ FOREX ‚îÄ‚îÄ
async function runForex(){
  typing();
  try{
    const r=await fetch(FX_URL+'?from=USD&to=EUR,GBP,JPY,CHF,CAD,RUB,UAH').then(x=>x.json());
    rmTp();
    const rt=r.rates||{};
    const pairs=[
      ['EUR/USD',(1/rt.EUR).toFixed(4)],['GBP/USD',(1/rt.GBP).toFixed(4)],
      ['USD/JPY',rt.JPY?.toFixed(2)],['USD/CHF',rt.CHF?.toFixed(4)],
      ['USD/CAD',rt.CAD?.toFixed(4)]
    ];
    if(rt.RUB) pairs.push(['USD/RUB',rt.RUB?.toFixed(2)]);
    if(rt.UAH) pairs.push(['USD/UAH',rt.UAH?.toFixed(2)]);
    const rows=pairs.map(([p,v])=>`<div class="mr"><div class="mn">${p}</div><div class="mp"><div class="mv">${v||'‚Äì'}</div></div></div>`).join('');
    const d=document.createElement('div');d.className='msg';
    d.innerHTML=`<div class="bb ai">üí± <b>–§–æ—Ä–µ–∫—Å</b> ‚Äî live –∫ USD<div class="mt">${rows}</div><div class="cbs" style="margin-top:8px"><button class="cb cb-gold" onclick="wolfQ('–§–æ—Ä–µ–∫—Å: EUR/USD ${(1/rt.EUR).toFixed(4)}, GBP/USD ${(1/rt.GBP).toFixed(4)}, USD/JPY ${rt.JPY?.toFixed(2)}. –ö—É–¥–∞ –¥–æ–ª–ª–∞—Ä —Å–µ–≥–æ–¥–Ω—è –∏ –∫–∞–∫—É—é –ø–∞—Ä—É –≤–∑—è—Ç—å –Ω–∞ —Ñ–ª–∏–ø–ø?')">üê∫ –ü—Ä–æ–≥–Ω–æ–∑ –í–æ–ª–∫–∞</button></div></div>`;
    $chat().appendChild(d);scroll();
  }catch(e){rmTp();bot('‚ö†Ô∏è –§–æ—Ä–µ–∫—Å: '+esc(e.message))}
}

// ‚îÄ‚îÄ FEAR & GREED ‚îÄ‚îÄ
async function runFng(){
  typing();
  try{
    const [fng,glob]=await Promise.all([
      fetch(FNG_URL).then(r=>r.json()),
      fetch(CG+'/global').then(r=>r.json()).catch(()=>null)
    ]);
    rmTp();
    const data=fng.data||[];
    const cur=data[0];const v=parseInt(cur?.value||50);const lb=cur?.value_classification||'Neutral';
    const fc=v>=70?'var(--g)':v>=55?'#8aff72':v>=45?'var(--y)':v>=30?'var(--o)':'var(--r)';
    mktCtx.fng=v;mktCtx.fngLbl=lb;
    const wop=v>=75?'"–í—Å–µ –∂–∞–¥–Ω—ã–µ. –£–º–Ω—ã–π —Ç–∏—Ö–æ –≤—ã—Ö–æ–¥–∏—Ç, –ø–æ–∫–∞ —Ç–æ–ª–ø–∞ –∫—Ä–∏—á–∏—Ç buy."':v>=55?'"–†—ã–Ω–æ–∫ —Ç—ë–ø–ª—ã–π. –î–µ—Ä–∂–∏ —á—Ç–æ –µ—Å—Ç—å, –Ω–æ–≤–æ–µ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–π –±–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä–∞."':v>=45?'"–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ. –ì–æ—Ç–æ–≤—å —Å–ø–∏—Å–æ–∫ –Ω–∞ –∑–∞–∫—É–ø–∫—É. –ñ–¥–∏ –¥–Ω–∞."':v>=30?'"–ö—Ä–æ–≤—å –Ω–∞ —É–ª–∏—Ü–∞—Ö. –°—Ç—Ä–∞—Ö ‚Äî —Ç–≤–æ–π –ª—É—á—à–∏–π —Å–æ—é–∑–Ω–∏–∫. –ü–æ–∫—É–ø–∞–π."':'"–ü–∞–Ω–∏–∫–∞. –î–Ω–∞ –Ω–µ –≤–∏–¥–Ω–æ. –¢–æ–ª—å–∫–æ —Å—Ç–∞–ª—å–Ω—ã–µ –Ω–µ—Ä–≤—ã –≤—ã–∂–∏–≤—É—Ç."';
    const hist=data.slice(1,7).map(d=>{const dv=parseInt(d.value);return`<div class="hrow"><span style="font-size:10px;color:var(--dim)">${new Date(d.timestamp*1000).toLocaleDateString('ru',{month:'short',day:'numeric'})}</span><span style="font-size:11px;font-weight:700;color:${dv>=50?'var(--g)':'var(--r)'}">${dv} ‚Äî ${d.value_classification}</span></div>`}).join('');
    const dom=(glob?.data?.market_cap_percentage?.btc||0).toFixed(1);
    const d=document.createElement('div');d.className='msg';
    d.innerHTML=`<div class="bb ai">üò± <b>Fear & Greed Index</b>
      <div style="display:flex;gap:14px;align-items:center;margin:10px 0 8px">
        <div class="fng-ring" style="border-color:${fc}"><div class="fng-n" style="color:${fc}">${v}</div><div class="fng-l" style="color:${fc}">${lb}</div></div>
        <div style="flex:1">${hist}</div>
      </div>
      ${glob?`<div class="stats"><div class="s"><div class="sl">BTC dom</div><div class="sv">${dom}%</div></div><div class="s"><div class="sl">–†—ã–Ω–æ–∫ 24h</div><div class="sv chg ${cl(mktCtx.mkt24h)}">${cs(mktCtx.mkt24h)}</div></div></div>`:''}
      <div class="wq">${wop}</div></div>`;
    $chat().appendChild(d);scroll();
  }catch(e){rmTp();bot('‚ö†Ô∏è F&G: '+esc(e.message))}
}

// ‚îÄ‚îÄ ON-CHAIN ANALYZE ‚îÄ‚îÄ
async function runAnalyze(addr){
  addr=addr.trim();typing();
  try{
    const [dex,hd]=await Promise.all([
      fetch(DEX+'/latest/dex/tokens/'+addr).then(x=>x.json()),
      getHolders(addr)
    ]);
    const pairs=(dex.pairs||[]).filter(p=>p.chainId==='solana');
    rmTp();
    if(!pairs.length){bot('üîç –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ Solana DEX.');return}
    const p=pairs[0];
    const sym=p.baseToken?.symbol||'?',mc=p.fdv||p.marketCap||0,lq=p.liquidity?.usd||0;
    const b=p.txns?.h24?.buys||0,s=p.txns?.h24?.sells||0;
    const hasTg=!!p.info?.socials?.find(x=>x.type==='telegram');
    const hasTw=!!p.info?.socials?.find(x=>x.type==='twitter');
    const hasSite=!!p.info?.websites?.length;
    let rug=0;
    if(lq<5000)rug+=30;else if(lq<20000)rug+=12;
    if(!hasTg&&!hasTw&&!hasSite)rug+=22;
    if(b<10)rug+=15;if(s>b*3)rug+=15;
    if(hd.topPct>20)rug+=20;
    rug=Math.min(100,rug);
    const rc=rug>=70?'var(--r)':rug>=40?'var(--y)':'var(--g)';
    const bp=b+s>0?Math.round(b/(b+s)*100):50;
    const holdHtml=hd.list.length?`<div class="card" style="margin-top:5px;padding:8px 11px"><div class="sec" style="margin-bottom:5px">üîó On-chain ¬∑ —Ç–æ–ø –¥–µ—Ä–∂–∞—Ç–µ–ª–∏</div>${hd.list.map(h=>`<div class="hrow"><div><span style="font-size:10px;color:var(--dim);font-family:monospace">${h.a.slice(0,8)}‚Ä¶${h.a.slice(-4)}</span>${h.dev?'<span style="font-size:9px;padding:1px 4px;border-radius:4px;background:rgba(255,68,102,.15);color:var(--r);margin-left:4px">‚ö†Ô∏è DEV?</span>':''}</div><div class="sv" style="color:${h.p>20?'var(--r)':h.p>10?'var(--y)':'var(--g)'}">${h.p.toFixed(1)}%</div></div>`).join('')}${hd.topPct>25?`<div style="font-size:11px;color:var(--r);margin-top:5px">‚ö†Ô∏è –¢–æ–ø –¥–µ—Ä–∂–∞—Ç–µ–ª—å ${hd.topPct.toFixed(0)}% ‚Äî rug —Ä–∏—Å–∫</div>`:''}</div>`:'';
    const dexUrl=p.url||'https://dexscreener.com/solana/'+(p.pairAddress||'');
    const c1=+p.priceChange?.h1||0,age=p.pairCreatedAt?Date.now()-p.pairCreatedAt:null;
    const d=document.createElement('div');d.className='msg';
    d.innerHTML=`<div class="bb ai">üîç <b>${esc(sym)}</b> ‚Äî –∞–Ω–∞–ª–∏–∑${tokenCard(p)}<div class="card" style="margin-top:5px"><div style="display:flex;justify-content:space-between;margin-bottom:4px"><span style="font-size:11px;color:var(--dim)">üõ° Rug Risk</span><b style="color:${rc}">${rug}/100 ${rug>=70?'‚õî –í–´–°–û–ö–ò–ô':rug>=40?'‚ö†Ô∏è –°–†–ï–î–ù–ò–ô':'‚úÖ –ù–ò–ó–ö–ò–ô'}</b></div><div class="rug-b"><div class="rug-f" style="width:${rug}%;background:${rc}"></div></div><div style="display:flex;gap:12px;margin-top:6px;font-size:11px"><span>TG ${hasTg?'‚úÖ':'‚ùå'}</span><span>TW ${hasTw?'‚úÖ':'‚ùå'}</span><span>–°–∞–π—Ç ${hasSite?'‚úÖ':'‚ùå'}</span><span>Buy% <b style="color:${bp>55?'var(--g)':'var(--r)'}">${bp}%</b></span></div></div>${holdHtml}<div class="cbs" style="margin-top:8px"><button class="cb cb-g" onclick="addBag('${esc(addr)}','${esc(sym)}',${+p.priceUsd||0})">+–í–æ–π—Ç–∏</button><button class="cb cb-gold" onclick="wolfQ('${esc(sym)}: mcap=${f$(mc)}, –ª–∏–∫–≤=${f$(lq)}, rug=${rug}/100, buy%=${bp}%, —Ç–æ–ø –¥–µ—Ä–∂–∞—Ç–µ–ª—å=${hd.topPct.toFixed(0)}%, –≤–æ–∑—Ä–∞—Å—Ç=${age?fa(age):&apos;?&apos;}. –§–ª–∏–ø–ø –∏–ª–∏ –Ω–µ—Ç? 3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.')">üê∫ –†–µ—à–µ–Ω–∏–µ –í–æ–ª–∫–∞</button><a href="${dexUrl}" target="_blank" style="text-decoration:none"><button class="cb cb-p">DEX ‚Üó</button></a></div></div>`;
    $chat().appendChild(d);scroll();
  }catch(e){rmTp();bot('‚ö†Ô∏è –ê–Ω–∞–ª–∏–∑: '+esc(e.message))}
}

async function getHolders(mint){
  try{
    const [la,sup]=await Promise.all([
      fetch(SOL_RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',id:1,method:'getTokenLargestAccounts',params:[mint]})}).then(x=>x.json()),
      fetch(SOL_RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',id:2,method:'getTokenSupply',params:[mint]})}).then(x=>x.json())
    ]);
    const total=parseFloat(sup.result?.value?.uiAmount||0);
    if(!total)return{list:[],topPct:0};
    const list=(la.result?.value||[]).slice(0,5).map((a,i)=>{const p=parseFloat(a.uiAmount||0)/total*100;return{a:a.address,p,dev:i===0&&p>15}});
    return{list,topPct:list[0]?.p||0};
  }catch{return{list:[],topPct:0}}
}

// ‚îÄ‚îÄ PORTFOLIO ‚îÄ‚îÄ
async function runBag(){
  if(!portfolio.length){bot('üíº –ü–æ—Ä—Ç—Ñ–µ–ª—å –ø—É—Å—Ç–æ–π. –ù–∞–∂–º–∏ <b>+–í–æ–π—Ç–∏</b> –Ω–∞ –ª—é–±–æ–º —Ç–æ–∫–µ–Ω–µ.');return}
  typing();
  try{
    const addrs=[...new Set(portfolio.map(p=>p.addr))].filter(Boolean);
    const pm={};
    if(addrs.length){const r=await fetch(DEX+'/latest/dex/tokens/'+addrs.join(',')).then(x=>x.json());for(const p of(r.pairs||[])){if(p.baseToken?.address)pm[p.baseToken.address]={price:+p.priceUsd||0,sym:p.baseToken.symbol}}}
    rmTp();
    let tot=0;
    const rows=portfolio.map((pos,i)=>{
      const cur=pm[pos.addr]?.price||0,sym=pm[pos.addr]?.sym||pos.sym||'?';
      const pnl=pos.entry>0?(cur-pos.entry)/pos.entry*100:0;
      tot+=pnl;
      return `<div class="prow"><div><b>${esc(sym)}</b><br><span style="font-size:10px;color:var(--dim)">${pos.entry?f$(pos.entry):'?'} ¬∑ ${pos.sol||0} SOL ¬∑ ${fa(Date.now()-pos.ts)}</span></div><div style="text-align:right"><div style="font-weight:700;color:${pnl>=0?'var(--g)':'var(--r)'}">${pnl>=0?'+':''}${pnl.toFixed(1)}%</div><div style="font-size:10px;color:var(--dim)">${cur?f$(cur):'‚Äì'}</div><button class="cb cb-r" style="margin-top:3px;font-size:9px" onclick="closePos(${i})">‚úó –∑–∞–∫—Ä—ã—Ç—å</button></div></div>`;
    }).join('');
    const avg=portfolio.length?tot/portfolio.length:0;
    bot(`üíº <b>–ü–æ—Ä—Ç—Ñ–µ–ª—å</b> ¬∑ avg <span style="color:${avg>=0?'var(--g)':'var(--r)'};font-weight:700">${avg>=0?'+':''}${avg.toFixed(1)}%</span>${rows}`);
  }catch(e){rmTp();bot('‚ö†Ô∏è '+esc(e.message))}
}
function addBag(addr,sym,price){
  portfolio.push({id:Date.now(),addr,sym,entry:price,sol:0,ts:Date.now()});
  localStorage.setItem('gl_portfolio',JSON.stringify(portfolio));
  bot(`‚úÖ <b>${esc(sym)}</b> –¥–æ–±–∞–≤–ª–µ–Ω. –ó–∞–¥–∞–π —Ä–∞–∑–º–µ—Ä: <i>–≤—Ö–æ–¥ ${esc(sym)} –†–ê–ó–ú–ï–†_SOL</i>`);
}
function closePos(i){const s=portfolio[i]?.sym||'?';portfolio.splice(i,1);localStorage.setItem('gl_portfolio',JSON.stringify(portfolio));bot(`‚ùå <b>${esc(s)}</b> –∑–∞–∫—Ä—ã—Ç`)}

// ‚îÄ‚îÄ TG PUSH ‚îÄ‚îÄ
async function pushTg(sym,addr,c1,vol1,lq,b,s,age){
  if(!tgBot||!tgChat){bot('üì§ TG –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –í–≤–µ–¥–∏: <code>tg token BOT_TOKEN</code> –∏ <code>tg chat @USERNAME</code>');return}
  const txt=`üî• ${sym} ¬∑ Solana\n‚è± ${fa(age)} ¬∑ üìà +${c1.toFixed(1)}%\nVol 1—á: $${(vol1/1000).toFixed(1)}K ¬∑ Liq: $${(lq/1000).toFixed(1)}K\nB/S: ${b}B / ${s}S\nüîó dexscreener.com/solana/${addr}`;
  try{await fetch(`https://api.telegram.org/bot${tgBot}/sendMessage`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({chat_id:tgChat,text:txt})});bot(`üì§ ${esc(sym)} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ ${esc(tgChat)}`)}
  catch(e){bot('‚ö†Ô∏è TG: '+esc(e.message))}
}
async function autoTgPush(tokens){
  if(!tgBot||!tgChat)return;
  for(const p of tokens){const addr=p.baseToken?.address||'';if(pushed.has(addr))continue;pushed.add(addr);const sym=p.baseToken?.symbol||'?',c1=+p.priceChange?.h1||0,v1=p.volume?.h1||0,lq=p.liquidity?.usd||0,b=p.txns?.h24?.buys||0,s=p.txns?.h24?.sells||0,age=p.pairCreatedAt?Date.now()-p.pairCreatedAt:0;await pushTg(sym,addr,c1,v1,lq,b,s,age)}
  localStorage.setItem('gl_pushed',JSON.stringify([...pushed]));
}

function startAuto(){
  clearInterval(autoTimer);
  autoTimer=setInterval(()=>{if(!killed)runScan()},120000);
}

// ‚îÄ‚îÄ WOLF AI (THE BRAIN) ‚îÄ‚îÄ
const WOLF_SYSTEM=`–¢—ã WOLF ‚Äî –í–æ–ª–∫ —Å –£–æ–ª–ª-—Å—Ç—Ä–∏—Ç –∫—Ä–∏–ø—Ç–æ-—Ä—ã–Ω–∫–∞. –ì–µ–Ω–∏–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π.

–ü–æ–∫—Ä—ã–≤–∞–µ—à—å: –∫—Ä–∏–ø—Ç–æ (–º–µ–º—ã Solana, BTC, ETH, –∞–ª—å—Ç—ã), –∞–∫—Ü–∏–∏ (S&P500, NASDAQ, –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∏–∫–µ—Ä—ã), —Ñ–æ—Ä–µ–∫—Å, –¥–µ—Ä–∏–≤–∞—Ç–∏–≤—ã, commodities.

–õ–∏—á–Ω–æ—Å—Ç—å: –æ—Å—Ç—Ä—ã–π, —É–≤–µ—Ä–µ–Ω–Ω—ã–π, –∂—ë—Å—Ç–∫–∏–π. –î–∂–æ—Ä–¥–∞–Ω –ë–µ–ª—Ñ–æ—Ä—Ç √ó Ray Dalio. –ù–æ–ª—å –≤–æ–¥—ã, –Ω–æ–ª—å "–º–æ–∂–µ—Ç –±—ã—Ç—å". –¢–æ–ª—å–∫–æ: —Å–∏–≥–Ω–∞–ª ‚Üí –¥–µ–π—Å—Ç–≤–∏–µ ‚Üí —É—Ä–æ–≤–µ–Ω—å ‚Üí —Ä–∏—Å–∫.

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî –∫—Ä–∞—Ç–∫–æ (3-6 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π):
1. –°–∏–≥–Ω–∞–ª: BUY / SELL / HOLD / –ü–†–û–ü–£–°–¢–ò–¢–¨
2. –ü—Ä–∏—á–∏–Ω–∞ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è)
3. –£—Ä–æ–≤–µ–Ω—å –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞ –∏–ª–∏ —Å—Ç–æ–ø-–ª–æ—Å—Å (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
4. –†–∏—Å–∫ (1-10)

–°—Ç–∏–ª—å: –≥–æ–≤–æ—Ä–∏ –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫, –Ω–µ –∫–∞–∫ –±–æ—Ç. –ò—Å–ø–æ–ª—å–∑—É–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Ä—É—Å. –ú–æ–∂–Ω–æ 1-2 —ç–º–æ–¥–∑–∏.
–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π ‚Äî —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–π –∫ –¥–µ–Ω—å–≥–∞–º.`;

async function wolfQ(question){
  const groqKey=localStorage.getItem('gl_groq');
  if(!groqKey){
    bot(`üê∫ –ù—É–∂–µ–Ω Groq API –∫–ª—é—á –¥–ª—è –º–æ–∑–≥–∞.<div class="setup"><b>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ (30 —Å–µ–∫):</b><br>1. <a href="https://console.groq.com/keys" target="_blank" style="color:var(--gold)">console.groq.com/keys ‚Üó</a> ‚Üí Create API Key<br>2. –í–≤–µ–¥–∏: <code style="color:var(--gold)">groq sk-...</code><br><br>–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ WOLF –¥—É–º–∞–µ—Ç –∫–∞–∫ —Å—Ç—Ä–∞—Ç–µ–≥.</div>`);
    return;
  }
  const ctx=`\n[–ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä—ã–Ω–∫–∞: BTC $${mktCtx.btc?.toLocaleString('en')||'?'}, ETH $${mktCtx.eth?.toLocaleString('en')||'?'}, SOL $${mktCtx.sol?.toFixed(2)||'?'}, F&G: ${mktCtx.fng} (${mktCtx.fngLbl}), —Ä—ã–Ω–æ–∫ 24h: ${cs(mktCtx.mkt24h)}]`;
  const t=document.createElement('div');t.className='msg';t.id='tp';t.innerHTML='<div class="bb ai wolf"><div class="dots"><span>‚óè</span><span>‚óè</span><span>‚óè</span></div></div>';$chat().appendChild(t);scroll();
  try{
    const resp=await fetch(GROQ_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':'Bearer '+groqKey},
      body:JSON.stringify({model:'llama-3.3-70b-versatile',messages:[{role:'system',content:WOLF_SYSTEM},{role:'user',content:question+ctx}],max_tokens:512,stream:true,temperature:0.7})
    });
    if(!resp.ok){rmTp();bot('‚ö†Ô∏è Groq: '+resp.status+'. –ü—Ä–æ–≤–µ—Ä—å –∫–ª—é—á –∫–æ–º–∞–Ω–¥–æ–π: groq [–∫–ª—é—á]');return}
    const reader=resp.body.getReader();const dec=new TextDecoder();
    let reply='',bbl=null;
    while(true){
      const{done,value}=await reader.read();if(done)break;
      const chunk=dec.decode(value);
      for(const line of chunk.split('\n')){
        if(!line.startsWith('data:'))continue;
        const d=line.slice(5).trim();if(d==='[DONE]')break;
        try{const j=JSON.parse(d);const delta=j.choices?.[0]?.delta?.content||'';
          if(delta){reply+=delta;if(!bbl){const el=document.getElementById('tp');if(el)el.innerHTML='<div class="bb ai wolf"></div>';bbl=document.querySelector('#tp .bb')}
          if(bbl)bbl.innerHTML='üê∫ '+reply.replace(/\n/g,'<br>').replace(/</g,'&lt;').replace(/&lt;br>/g,'<br>');scroll()}
        }catch{}
      }
    }
    const final=document.getElementById('tp');if(final){final.removeAttribute('id')}
    if(!reply){rmTp();bot('üê∫ –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.')}
  }catch(e){rmTp();bot('‚ö†Ô∏è WOLF: '+esc(e.message))}
}

// ‚îÄ‚îÄ WOLF INTRO ‚îÄ‚îÄ
function wolfIntro(){
  const d=document.createElement('div');d.className='msg';
  d.innerHTML=`<div class="bb ai wolf">üê∫ <b>–Ø WOLF.</b> –ì–µ–Ω–∏–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä—ã–Ω–∫–æ–≤. –¢–æ—Ä–≥—É—é –º–µ–º—ã, BTC, –∞–∫—Ü–∏–∏, —Ñ–æ—Ä–µ–∫—Å ‚Äî –≤–µ–∑–¥–µ –≥–¥–µ –µ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ.<div class="wq">"–î–µ–Ω—å–≥–∏ –Ω–µ —Å–ø—è—Ç. –ê —Ç—ã?"</div>–ß—Ç–æ —Ö–æ—á–µ—à—å –∑–Ω–∞—Ç—å ‚Äî –∫—Ä–∏–ø—Ç–æ, –∞–∫—Ü–∏–∏, —Ñ–æ—Ä–µ–∫—Å –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω?<br><br><b>–ö–æ–º–∞–Ω–¥—ã:</b><br>‚Ä¢ –¢–∞–ø–Ω–∏ —á–∏–ø—ã –≤–≤–µ—Ä—Ö—É ‚Üí –¥–∞–Ω–Ω—ã–µ —Ä—ã–Ω–∫–∞<br>‚Ä¢ <code>–∞–Ω–∞–ª–∏–∑ [–∞–¥—Ä–µ—Å]</code> ‚Üí on-chain —Ç–æ–∫–µ–Ω<br>‚Ä¢ <code>groq [–∫–ª—é—á]</code> ‚Üí –ø–æ–¥–∫–ª—é—á–∏—Ç—å –º–æ–∑–≥ (Groq API)<br>‚Ä¢ <code>tg token [BOT_TOKEN]</code> ‚Üí TG –±–æ—Ç<br>‚Ä¢ <code>tg chat [@–∫–∞–Ω–∞–ª]</code> ‚Üí –∫–∞–Ω–∞–ª –¥–ª—è –ø—É—à–∞</div>`;
  $chat().appendChild(d);scroll();
}

// ‚îÄ‚îÄ COMMAND ROUTER ‚îÄ‚îÄ
function cmd(t){userBubble(t);route(t)}

async function route(t){
  const tl=t.toLowerCase().trim();
  if(tl==='—Å–∫–∞–Ω'||tl==='scan'||tl==='solana'){await runScan();return}
  if(tl==='pump'||tl==='pump.fun'){await runPump();return}
  if(tl==='–∫—Ä–∏–ø—Ç–æ'||tl==='crypto'||tl==='–±–∏—Ç–æ–∫'||tl==='btc'){await runCrypto();return}
  if(tl==='–∞–∫—Ü–∏–∏'||tl==='stocks'||tl==='sp500'){await runStocks();return}
  if(tl==='—Ñ–æ—Ä–µ–∫—Å'||tl==='forex'){await runForex();return}
  if(tl==='—Ñ–Ω–≥'||tl==='f&g'||tl==='fg'||tl==='fear'){await runFng();return}
  if(tl==='–±–∞–≥'||tl==='bag'||tl==='–ø–æ—Ä—Ç—Ñ–µ–ª—å'||tl==='portfolio'){await runBag();return}
  if(tl==='wolf'||tl==='–≤–æ–ª–∫'||tl==='help'||tl==='–ø–æ–º–æ—â—å'){wolfIntro();return}
  // groq key setup
  if(tl.startsWith('groq ')){const k=t.slice(5).trim();if(k){localStorage.setItem('gl_groq',k);bot('‚úÖ Groq –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω—ë–Ω. –ú–æ–∑–≥ –í–æ–ª–∫–∞ –ø–æ–¥–∫–ª—é—á—ë–Ω. üê∫');return}}
  // tg setup
  if(tl.startsWith('tg token ')){const v=t.slice(9).trim();if(v){tgBot=v;localStorage.setItem('gl_telegram',v);bot('‚úÖ TG Bot Token —Å–æ—Ö—Ä–∞–Ω—ë–Ω.');return}}
  if(tl.startsWith('tg chat ')){const v=t.slice(8).trim();if(v){tgChat=v;localStorage.setItem('gl_tg_chat',v);bot('‚úÖ TG Chat —Å–æ—Ö—Ä–∞–Ω—ë–Ω: '+esc(v));return}}
  // analyze by address
  const addrMatch=t.match(/[1-9A-HJ-NP-Za-km-z]{32,44}/);
  if(addrMatch){await runAnalyze(addrMatch[0]);return}
  if(tl.includes('–∞–Ω–∞–ª–∏–∑ ')){const a=t.replace(/–∞–Ω–∞–ª–∏–∑\s*/i,'').trim();if(a)await runAnalyze(a);return}
  // portfolio entry
  const vhMatch=t.match(/–≤—Ö–æ–¥\s+(\S+)\s+([\d.]+)\s*(sol)?/i);
  if(vhMatch){const sym=vhMatch[1].toUpperCase(),sol=parseFloat(vhMatch[2]);const pos=portfolio.find(p=>p.sym?.toUpperCase()===sym);if(pos){pos.sol=sol;localStorage.setItem('gl_portfolio',JSON.stringify(portfolio));bot(`‚úÖ ${esc(sym)}: ${sol} SOL`);return}else{bot(`‚ùå ${esc(sym)} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ. –°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏ +–í–æ–π—Ç–∏`);return}}
  // everything else ‚Üí WOLF AI
  wolfQ(t);
}

// ‚îÄ‚îÄ INPUT ‚îÄ‚îÄ
function send(){const inp=document.getElementById('inp'),t=inp.value.trim();if(!t)return;inp.value='';inp.style.height='auto';route(t)}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded',()=>{
  wolfIntro();
  // Load market context silently
  fetch(CG+'/coins/markets?vs_currency=usd&ids=bitcoin,ethereum,solana&order=market_cap_desc').then(r=>r.json()).then(coins=>{
    const btc=coins.find(c=>c.id==='bitcoin'),eth=coins.find(c=>c.id==='ethereum'),sol=coins.find(c=>c.id==='solana');
    if(btc)mktCtx.btc=btc.current_price;if(eth)mktCtx.eth=eth.current_price;
    if(sol){mktCtx.sol=sol.current_price;mktCtx.solTrend=sol.price_change_percentage_24h}
    document.getElementById('strip').textContent=`BTC $${(mktCtx.btc||0).toLocaleString('en')} ¬∑ ETH $${(mktCtx.eth||0).toLocaleString('en')} ¬∑ SOL $${(mktCtx.sol||0).toFixed(1)}`;
  }).catch(()=>{});
  fetch(FNG_URL).then(r=>r.json()).then(f=>{const v=parseInt(f.data?.[0]?.value||50);mktCtx.fng=v;mktCtx.fngLbl=f.data?.[0]?.value_classification||'Neutral'}).catch(()=>{});
  startAuto();
});
</script>
</body>
</html>
